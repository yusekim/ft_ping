# ping(8)

*iputils – 20221126*

---

## NAME

```
ping - send ICMP ECHO_REQUEST to network hosts
```

---

## SYNOPSIS

```bash
ping [ -aAbBdCDefhLnOqrRUvV46 ] [ -c count ] [ -F flowlabel ] [ -i interval ]
     [ -I interface ] [ -l preload ] [ -m mark ] [ -M pmtudisc_option ]
     [ -N nodeinfo_option ] [ -w deadline ] [ -W timeout ] [ -p pattern ]
     [ -Q tos ] [ -s packetsize ] [ -S sndbuf ] [ -t ttl ]
     [ -T timestamp option ] [hop...] {destination}
```

---

## DESCRIPTION

`ping`는 네트워크 호스트나 게이트웨이에 ICMP의 필수 ECHO_REQUEST 다트그램을 보내어
ICMP ECHO_RESPONSE를 유도하는 명령어입니다. ECHO_REQUEST 패킷은 IP 및 ICMP 헤더,
`struct timeval` 및 패딩 바이트들로 구성됩니다.

- **IPv4/IPv6 지원:** 기본적으로 둘 다 지원하며, `-4` 또는 `-6` 옵션으로 특정 프로토콜만 사용하도록 할 수 있습니다.
- **IPv6 Node Information Query:** RFC4620에 따라 지원하며, 중간 홉에서는 제한될 수 있습니다(IPv6 소스 라우팅이 RFC5095에서 폐지됨).

---

## OPTIONS

각 옵션에 대한 설명은 다음과 같습니다:

### `-4`
- **설명:** IPv4만 사용합니다.

### `-6`
- **설명:** IPv6만 사용합니다.

### `-a`
- **설명:** Audible ping을 실행합니다.

### `-A`
- **설명:** Adaptive ping
  - 인터패킷 간격이 RTT(왕복시간)에 따라 조정되어, 기본적으로 미응답 패킷이 1개(또는 preload가 설정된 경우 그 이상)만 유지되도록 합니다.
  - 최소 간격은 200msec이며, 네트워크 RTT가 낮은 경우 사실상 flood mode와 유사하게 동작합니다.

### `-b`
- **설명:** 브로드캐스트 주소에 ping을 허용합니다.

### `-B`
- **설명:** 프로브의 소스 주소 변경을 허용하지 않습니다.
  - ping 시작 시 선택된 주소에 고정됩니다.

### `-c count`
- **설명:** `count` 만큼의 ECHO_REQUEST 패킷을 전송한 후 중지합니다.
  - `-w` (deadline) 옵션과 함께 사용 시, 지정된 시간 내에 `count` 개의 ECHO_REPLY를 받을 때까지 대기합니다.

### `-C`
- **설명:** 소켓 생성 시 `connect()` 시스템 콜을 호출합니다.

### `-d`
- **설명:** 사용 중인 소켓에 `SO_DEBUG` 옵션을 설정합니다.
  - Linux 커널에서는 별로 활용되지 않습니다.

### `-e`
- **설명:** ECHO_REQUEST의 식별 필드를 설정합니다.
  - 값이 0이면 raw 소켓을 사용(단, ICMP 다트그램 소켓에서는 지원되지 않음).
  - `-v` 옵션과 함께 해당 값이 출력될 수 있습니다.

### `-D`
- **설명:** 각 출력 라인 앞에 타임스탬프(유닉스 시간 + 마이크로초)를 표시합니다.

### `-f`
- **설명:** Flood ping
  - ECHO_REQUEST를 보낼 때마다 점(`.`)을 출력하고, ECHO_REPLY를 받을 때마다 백스페이스를 출력하여 패킷 손실을 빠르게 확인합니다.
  - 간격을 지정하지 않으면 0으로 설정되어 최대한 빠르게 출력되거나 초당 100회로 제한됩니다.
  - 단, 0 간격 사용은 super-user만 가능합니다.

### `-F flow label`
- **설명:** (IPv6 전용) echo request 패킷에 20비트의 flow label(16진수)을 할당 및 설정합니다.
  - 값이 0이면 커널이 랜덤 flow label을 할당합니다.

### `-h`
- **설명:** 도움말을 출력합니다.

### `-i interval`
- **설명:** 각 패킷 전송 사이에 `interval` 초만큼 대기합니다.
  - 소수점 표기(예: 0.5) 가능하며, 기본값은 1초입니다(단, flood mode에서는 대기 없음).
  - 2ms 미만의 간격은 super-user만 설정할 수 있습니다.

### `-I interface`
- **설명:** 소스 인터페이스를 지정합니다.
  - `interface`는 IP 주소, 인터페이스 이름 또는 VRF 이름일 수 있습니다.
    - 주소인 경우: 지정된 인터페이스 주소를 소스 주소로 사용합니다.
    - 인터페이스 이름인 경우: 해당 인터페이스를 소스 인터페이스로 사용합니다.
    - VRF 이름인 경우: 해당 라우팅 테이블을 통해 패킷을 전송하며, 이 경우 `-I` 옵션을 반복하여 소스 주소를 지정할 수 있습니다.
  - **참고:** IPv6 link-local 주소에 ping을 할 때 `%` 표기법이나 `-I` 옵션을 통해 인터페이스를 지정할 수 있으나, 더 이상 필수는 아닙니다.

### `-l preload`
- **설명:** 응답을 기다리지 않고 `preload` 만큼의 패킷을 미리 전송합니다.
  - 3개 초과의 preload는 super-user만 허용됩니다.

### `-L`
- **설명:** 멀티캐스트 패킷의 루프백(loopback)을 억제합니다.
  - 목적지가 멀티캐스트 주소일 때만 적용됩니다.

### `-m mark`
- **설명:** 송신되는 패킷에 지정된 mark를 태그합니다.
  - 커널 내 정책 라우팅 등에서 사용됩니다.

### `-M pmtudisc_opt`
- **설명:** Path MTU Discovery 전략을 선택합니다.
  - 옵션 값은 다음 중 하나입니다:
    - `do`: 단절(fragmentation)을 금지 (로컬 단절 포함)
    - `want`: PMTU 탐색 수행, 패킷 크기가 클 경우 로컬에서 단절
    - `dont`: DF 플래그를 설정하지 않음

### `-N nodeinfo_option`
- **설명:** (IPv6 전용) Echo Request 대신 ICMPv6 Node Information Query를 전송합니다.
  - `CAP_NET_RAW` 권한이 필요합니다.
- **세부 옵션:**
  - `help`: NI 지원에 대한 도움말 출력
  - `name`: 노드 이름 쿼리
  - `ipv6`: IPv6 주소 쿼리
    - `ipv6-global`: 전역 범위 주소 요청
    - `ipv6-sitelocal`: 사이트 로컬 주소 요청
    - `ipv6-linklocal`: 링크 로컬 주소 요청
    - `ipv6-all`: 다른 인터페이스의 IPv6 주소 요청
  - `ipv4`: IPv4 주소 쿼리
    - `ipv4-all`: 다른 인터페이스의 IPv4 주소 요청
  - `subject-ipv6=ipv6addr`: IPv6 subject 주소 지정
  - `subject-ipv4=ipv4addr`: IPv4 subject 주소 지정
  - `subject-name=nodename`: subject 이름 지정 (점이 2개 이상이면 FQDN으로 간주)
  - `subject-fqdn=nodename`: 항상 FQDN으로 간주되는 subject 이름 지정

### `-n`
- **설명:** 숫자 출력만 합니다. (호스트 주소에 대해 DNS 조회를 수행하지 않음)

### `-O`
- **설명:** 다음 패킷 전송 전에 미응답 ICMP ECHO reply를 보고합니다.
  - `-D` 옵션과 함께 로그를 기록하고 누락된 응답을 확인할 때 유용합니다.

### `-p pattern`
- **설명:** 최대 16 바이트의 패딩 데이터를 지정하여 패킷을 채웁니다.
  - 네트워크의 데이터 의존적 문제 진단에 유용합니다. 예: `-p ff`는 모든 바이트를 0xff(1)로 채웁니다.

### `-q`
- **설명:** 조용한 출력 모드.
  - 시작 시와 종료 시 요약 라인만 표시합니다.

### `-Q tos`
- **설명:** ICMP 다트그램의 Quality of Service 관련 비트를 설정합니다.
  - `tos` 값은 10진수 또는 16진수로 지정할 수 있습니다.
  - **참고:**
    - RFC2474에 따르면 8비트 DS 필드로 해석되며, 하위 2비트와 상위 6비트(DSCP)로 구성됩니다.
    - RFC2481 및 RFC3168에서는 하위 2비트가 ECN에 사용됩니다.
    - 과거(RFC1349, RFC2474 대체됨)에는:
      - 하위 1비트: 예약(현재 혼잡 제어 재정의 중)
      - 다음 4비트: Type of Service
      - 상위 3비트: Precedence

### `-r`
- **설명:** 일반 라우팅 테이블을 우회하여 직접 연결된 인터페이스로 패킷을 전송합니다.
  - 목적지가 직접 연결된 네트워크가 아니면 오류를 반환합니다.
  - `-I` 옵션과 함께 사용하면, 라우트가 없는 인터페이스로도 로컬 호스트에 ping을 할 수 있습니다.

### `-R`
- **설명:** Record route
  - ECHO_REQUEST 패킷에 RECORD_ROUTE 옵션을 포함시켜, 응답 패킷에서 경로 버퍼를 표시합니다.
  - IP 헤더의 공간 제한으로 최대 9개의 경로만 기록됩니다.

### `-s packetsize`
- **설명:** 전송할 데이터 바이트 수를 지정합니다.
  - 기본값은 56바이트이며, ICMP 헤더(8바이트)와 합쳐 64바이트가 전송됩니다.

### `-S sndbuf`
- **설명:** 소켓의 송신 버퍼 크기를 설정합니다.
  - 별도 지정하지 않으면 한 패킷 분량으로 설정됩니다.

### `-t ttl`
- **설명:** 패킷의 IP Time To Live(TTL)를 설정합니다.

### `-T timestamp option`
- **설명:** 특별한 IP 타임스탬프 옵션을 설정합니다.
  - 옵션 값은 다음 중 하나입니다:
    - `tsonly`: 타임스탬프만 기록
    - `tsandaddr`: 타임스탬프와 주소 모두 기록
    - `tsprespec host1 [host2 [host3 [host4]]]`: 사전 지정된 홉에 대해 타임스탬프 기록

### `-U`
- **설명:** 전체 사용자 간 지연 시간을 출력합니다(옛 동작 방식).
  - 일반적으로는 네트워크 왕복시간(RTT)만 출력되지만, DNS 지연 등의 이유로 실제 사용자 간 지연 시간이 다를 수 있습니다.

### `-v`
- **설명:** 자세한(Verbose) 출력을 합니다.
  - 멀티캐스트 대상에 ping 시 중복 응답(DUP reply)을 억제하지 않습니다.

### `-V`
- **설명:** 버전을 출력하고 종료합니다.

### `-w deadline`
- **설명:** 지정한 초(`deadline`) 후에, 전송 또는 수신한 패킷 수와 관계없이 ping을 종료합니다.
  - 패킷 개수와 함께 사용 시, deadline 내에 지정된 수의 응답을 받거나 오류가 발생할 때까지 대기합니다.

### `-W timeout`
- **설명:** 응답을 기다리는 시간(초)을 지정합니다.
  - 응답이 없을 때만 적용되며, 응답이 있으면 두 번의 RTT만큼 대기합니다.
  - 소수점 표기 가능하며, 0은 무한 대기를 의미합니다.

---

## 추가 정보

### Fault Isolation 및 통계

- **권장 사용법:**
  1. 로컬 호스트에서 ping을 실행하여 네트워크 인터페이스가 정상 동작하는지 확인
  2. 이후 점차 멀리 떨어진 호스트나 게이트웨이에 ping을 실행하여 네트워크 상태를 진단
- **통계:**
  - RTT(왕복 시간)와 패킷 손실 통계를 계산합니다.
  - 중복 패킷은 손실 계산에서 제외되지만, RTT 계산에는 포함됩니다.
- **종료 코드:**
  - 응답이 전혀 없으면 종료 코드 1
  - 패킷 수와 deadline이 모두 지정된 경우, 지정된 패킷 수보다 적게 응답하면 종료 코드 1
  - 다른 오류 발생 시 코드 2, 정상 종료 시 코드 0
  - 이를 통해 호스트의 생존 여부를 판단할 수 있습니다.

### IPv6 Link-Local Destinations

- **주의:**
  - IPv6 link-local 주소에 ICMP 다트그램 소켓을 사용할 때는 출력 인터페이스를 반드시 지정해야 합니다.
  - raw 소켓을 사용하는 경우에는 필수는 아니나, 중복 가능성을 피하기 위해 지정하는 것이 좋습니다.
- **지정 방법:**
  - **`%` 표기법:**
    ```bash
    ping fe80::5054:ff:fe70:67bc%eth0
    ping fe80::5054:ff:fe70:67bc%2
    ```
  - **`-I` 옵션 사용:**
    - kernel 버전 5.17, 5.15.19, 5.10.96, 5.4.176, 4.19.228, 4.14.265부터 지원 (musl libc에서는 미지원)

### ICMP Packet Details

- **구성:**
  - IP 헤더(옵션 없이 20바이트)
  - ICMP ECHO_REQUEST: 8바이트 ICMP 헤더 + 데이터
  - `packetsize` 옵션은 추가 데이터의 크기를 지정하며, 기본값은 56바이트
  - 따라서 ECHO_REPLY 패킷은 8바이트가 더 포함됩니다.
- **타임스탬프:**
  - 데이터 공간이 `struct timeval` 크기 이상일 경우, 처음 몇 바이트에 타임스탬프를 포함하여 RTT를 계산합니다.

### Duplicate and Damaged Packets

- **중복 패킷:**
  - 발생해서는 안 되며, 링크 레벨 재전송 문제 등으로 인해 발생할 수 있습니다.
- **손상된 패킷:**
  - 심각한 하드웨어 문제(네트워크 또는 호스트)를 시사합니다.

### 데이터 패턴 테스트

- 네트워크 계층은 데이터 내용에 상관없이 동일하게 처리해야 하지만,
  일부 데이터 의존적 문제는 특정 패턴(예: 전부 1 또는 전부 0, 또는 전환이 부족한 패턴)에서 발생할 수 있습니다.
- `-p` 옵션을 사용하여 다양한 패턴으로 테스트할 수 있습니다.

### TTL (Time To Live) 세부 정보

- **기능:**
  - 패킷이 지나갈 수 있는 최대 라우터(홉) 수를 나타내며, 각 라우터에서 1씩 감소합니다.
- **일반 값:**
  - 대부분의 Unix 시스템은 ICMP ECHO_REQUEST의 TTL을 255로 설정합니다.
- **응답 처리:**
  - 원격 시스템은 TTL 값을 변경하지 않거나(예전 BSD 방식), 255로 재설정하거나, 다른 값(예: 30 또는 60)으로 설정할 수 있습니다.

### BUGS

- 다수의 호스트와 게이트웨이가 RECORD_ROUTE 옵션을 무시합니다.
- IP 헤더의 최대 길이 제한으로 RECORD_ROUTE 옵션이 완벽하게 작동하지 않을 수 있습니다.
- Flood ping은 일반적으로 권장되지 않으며, 브로드캐스트 주소에 대해 flood ping을 실행하는 것은 매우 제한된 상황에서만 사용해야 합니다.

### SEE ALSO

- `ip(8)`, `ss(8)`

### HISTORY

- `ping` 명령은 4.3BSD에서 처음 등장하였습니다.
- 여기 설명된 버전은 Linux 전용입니다.
- **참고:**
  - 버전 s20150815부터 `ping6` 바이너리는 존재하지 않으며, `ping`에 통합되었습니다.
  - `ping6`라는 이름의 심볼릭 링크를 생성하면 동일하게 동작합니다.

### SECURITY

- `ping`은 다음 경우에 `CAP_NET_RAW` 권한이 필요합니다:
  1. 비 Echo Query(`-N` 옵션) 사용 또는 ECHO_REQUEST의 식별 필드를 0(`-e` 옵션)으로 설정할 때.
  2. 커널이 ICMP 다트그램 소켓을 지원하지 않을 때.
  3. 사용자가 ICMP 에코 소켓을 생성할 권한이 없을 때.
- 필요 시 set-uid root로 실행될 수 있습니다.

### AVAILABILITY

- `ping`은 `iputils` 패키지의 일부입니다.
